{
  "type": "feature",
  "project": "Assumptions Manager",
  "id": "PRD-008",
  "name": "Tenant and User Management",
  "description": "Admin endpoints for managing tenants and users within tenants. Foundation for multi-tenant SaaS operations.",
  "dependsOn": [
    "PRD-007"
  ],
  "userStories": [
    {
      "id": "US-001",
      "title": "List tenants (super admin)",
      "description": "As a super admin, I want to list all tenants so I can see who's using the platform",
      "acceptanceCriteria": [
        "GET /tenants returns list of all tenants",
        "Requires authentication",
        "Only super_admin role can access (others get 403)",
        "Returns tenant id, name, created_at"
      ],
      "priority": 1,
      "passes": true
    },
    {
      "id": "US-002",
      "title": "Create tenant",
      "description": "As a super admin, I want to create new tenants so I can onboard new customers",
      "acceptanceCriteria": [
        "POST /tenants creates a new tenant",
        "Accepts name (required)",
        "Returns created tenant with id",
        "Only super_admin role can access"
      ],
      "priority": 2,
      "passes": true
    },
    {
      "id": "US-003",
      "title": "List users in tenant",
      "description": "As a tenant admin, I want to list users in my tenant so I can manage my team",
      "acceptanceCriteria": [
        "GET /users returns list of users in current tenant",
        "Filtered by tenant_id from JWT (RLS enforced)",
        "Returns user id, email, role, created_at",
        "Does not return password_hash"
      ],
      "priority": 3,
      "passes": true
    },
    {
      "id": "US-004",
      "title": "Update user role",
      "description": "As a tenant admin, I want to change user roles so I can manage permissions",
      "acceptanceCriteria": [
        "PATCH /users/{id} accepts role field",
        "Only admin role within tenant can update",
        "Valid roles: viewer, analyst, admin",
        "Cannot demote yourself (prevent lockout)",
        "Returns updated user"
      ],
      "priority": 4,
      "passes": true
    },
    {
      "id": "US-005",
      "title": "Delete user",
      "description": "As a tenant admin, I want to remove users who no longer need access",
      "acceptanceCriteria": [
        "DELETE /users/{id} removes user",
        "Only admin role within tenant can delete",
        "Cannot delete yourself",
        "Returns 204 on success",
        "RLS ensures can only delete users in own tenant"
      ],
      "priority": 5,
      "passes": true
    }
  ],
  "technicalNotes": {
    "roles": "super_admin (platform-wide), admin (tenant-level), analyst, viewer",
    "superAdmin": "Create a super_admin user manually or via seed script for platform operations",
    "rls": "All user operations scoped to tenant_id from JWT except super_admin endpoints"
  },
  "definitionOfDone": [
    "All five stories implemented",
    "RLS enforces tenant isolation",
    "Role-based access control working",
    "Cannot delete/demote yourself"
  ]
}
